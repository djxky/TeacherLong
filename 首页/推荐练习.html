<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>推荐练习 - AI 龙老师</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Sans SC', sans-serif; background: linear-gradient(180deg, #F3E8FF 0%, #E8F4FD 50%, #E0F2FE 100%); display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .iphone-frame {
            width: 393px; height: 852px; background: linear-gradient(180deg, #F3E8FF 0%, #E8F4FD 50%, #E0F2FE 100%); position: relative; overflow: hidden;
            box-shadow: 0 0 0 12px #333, 0 0 0 13px #555, 0 20px 50px rgba(0,0,0,0.3); border-radius: 50px;
        }
        .dynamic-island { position: absolute; top: 11px; left: 50%; transform: translateX(-50%); width: 120px; height: 35px; background: #000; border-radius: 20px; z-index: 1000; pointer-events: none; }
        .glass-card { background: rgba(255,255,255,0.7); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.5); box-shadow: 0 8px 32px rgba(0,0,0,0.06), inset 0 1px 0 0 rgba(255,255,255,0.6); }
        .btn-liquid { background: linear-gradient(to right, #6A2C70, #8B5CF6, #06B6D4); box-shadow: 0 10px 40px -10px rgba(139,92,246,0.35); transition: transform 0.2s; }
        .btn-liquid:active { transform: scale(0.98); }
        .pdf-container { background: #f8fafc; border-radius: 16px; overflow: hidden; border: 1px solid rgba(0,0,0,0.06); }
        .pdf-container embed, .pdf-container iframe { width: 100%; height: 100%; border: none; }
        #toast { position: fixed; top: 60px; left: 50%; transform: translateX(-50%) translateY(-20px); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 24px; font-size: 13px; font-weight: 600; opacity: 0; transition: all 0.3s; z-index: 2000; }
        #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    </style>
</head>
<body>
    <div class="iphone-frame" id="app-root">
        <div class="dynamic-island"></div>
        <div id="toast">已复制到剪贴板</div>

        <div class="absolute inset-0 flex flex-col pt-[50px]">
            <header class="px-4 py-3 flex items-center justify-between shrink-0">
                <button onclick="goBack()" class="p-2 -ml-1 active:opacity-70">
                    <svg class="w-6 h-6 text-slate-800" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                </button>
                <h1 class="text-lg font-bold text-slate-800">推荐练习</h1>
                <div class="w-10"></div>
            </header>

            <main class="flex-1 overflow-y-auto no-scrollbar px-4 pb-8 space-y-4">
                <div class="glass-card rounded-[24px] p-4">
                    <p id="ai-recommend-text" class="text-sm text-slate-700 leading-relaxed"></p>
                </div>

                <div class="space-y-2">
                    <h2 class="text-sm font-bold text-slate-800">练习内容</h2>
                    <div class="pdf-container rounded-[24px] h-[420px] relative">
                        <embed id="pdf-embed" src="" type="application/pdf" class="w-full h-full min-h-[400px]" />
                        <div id="pdf-placeholder" class="hidden absolute inset-0 flex flex-col items-center justify-center text-slate-500 bg-slate-50/95 rounded-[24px] p-6 text-center">
                            <svg class="w-16 h-16 text-slate-300 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                            <p class="text-sm font-medium">推荐练习 PDF</p>
                            <p class="text-xs mt-1">《<span id="pdf-title-placeholder"></span>》</p>
                            <p class="text-xs text-slate-400 mt-2">点击下方「保存」下载后查看</p>
                        </div>
                    </div>
                </div>

                <div class="flex gap-3 pt-2">
                    <button onclick="sendToWechat()" class="flex-1 py-3 rounded-2xl font-bold text-sm flex items-center justify-center gap-2 glass-card text-slate-800 border-2 border-slate-200/60 active:scale-[0.98]">
                        <svg class="w-5 h-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" /></svg>
                        发送到微信
                    </button>
                    <button onclick="savePdf()" class="flex-1 py-3 rounded-2xl font-bold text-sm btn-liquid text-white flex items-center justify-center gap-2 active:scale-[0.98]">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                        保存
                    </button>
                </div>
            </main>
        </div>
    </div>

    <script>
        const recommendCopy = {
            quanguo: {
                reason: '你在《分式化简》《二次根式》等章节的正确率较高，但在几何证明与计算上仍有提升空间。',
                recommend: '全区高频题「每日一练：几何基础」，帮助你在薄弱板块上对标全区水平，巩固基础。'
            },
            cuoti: {
                reason: '根据你的错题本，你在「分式化简」「二次根式混合运算」中多次出现计算与化简错误。',
                recommend: '为你生成了《分式与二次根式巩固》专项练习，针对易错点举一反三，建议本周完成。'
            },
            juyi: {
                reason: '你已掌握一次函数基础，但在与几何、方程结合的综合题上失分较多。',
                recommend: '为你推荐《一次函数综合应用》举一反三练习，强化数形结合与分类讨论能力。'
            }
        };

        function goBack() {
            window.location.href = '首页.html';
        }

        function initPage() {
            const type = sessionStorage.getItem('recommendType') || 'quanguo';
            const tag = sessionStorage.getItem('recommendTag') || '全区高频';
            const title = sessionStorage.getItem('recommendTitle') || '每日一练:几何基础';

            const copy = recommendCopy[type] || recommendCopy.quanguo;
            const textEl = document.getElementById('ai-recommend-text');
            textEl.innerHTML = `基于你<strong class="text-slate-800">${copy.reason}</strong><br><br>为你推荐了<strong class="text-slate-800">${copy.recommend}</strong>`;

            document.getElementById('pdf-title-placeholder').textContent = title;

            var pdfUrl = 'https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf';
            var embedEl = document.getElementById('pdf-embed');
            var placeholderEl = document.getElementById('pdf-placeholder');
            embedEl.src = pdfUrl;
            embedEl.onerror = function () {
                placeholderEl.classList.remove('hidden');
                embedEl.classList.add('hidden');
            };
            window._recommendPdfUrl = pdfUrl;
            window._recommendTitle = title;
        }

        function sendToWechat() {
            const url = window.location.href;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(url).then(function () {
                    showToast('链接已复制，请打开微信粘贴发送');
                }).catch(function () {
                    showToast('请使用微信打开本页后点击右上角分享');
                });
            } else {
                showToast('请使用微信打开本页后点击右上角分享');
            }
        }

        function savePdf() {
            const url = window._recommendPdfUrl || 'https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf';
            const title = (window._recommendTitle || '推荐练习').replace(/[:\s]/g, '_');
            const a = document.createElement('a');
            a.href = url;
            a.download = title + '.pdf';
            a.target = '_blank';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            showToast('正在下载，请稍候…');
        }

        function showToast(msg) {
            const el = document.getElementById('toast');
            el.textContent = msg;
            el.classList.add('show');
            setTimeout(function () { el.classList.remove('show'); }, 2000);
        }

        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>
